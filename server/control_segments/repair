from autotest_lib.client.common_lib import host_protections


def repair(machine):
    protection = host_protections.Protection
    try:
        level = protection.get_value(protection_level)
    except ValueError:
        raise NotImplementedError("Unknown host protection level %s" %
                                  protection_level)
    # call the appropriate repair function based on protection level
    if level == protection.DO_NOT_REPAIR:
        print "Host is specified as 'Do not repair', skipping repair stage"
    elif level == protection.REPAIR_FILESYSTEM_ONLY:
        print "Attempting filesystem-only repair"
        host = hosts.create_host(machine, initialize=False)
        host.repair_filesystem_only()
        # JP: deprecated
        if "site_repair_filesystem_only" in globals():
            site_repair_filesystem_only(host)
    elif level == protection.NO_PROTECTION:
        print "Attempting full repair"
        host = hosts.create_host(machine, initialize=False, auto_monitor=False)
        host.repair_full()
        # JP: deprecated
        if "site_repair_full" in globals():
            site_repair_full(host)


job.parallel_simple(repair, machines, log=False)
