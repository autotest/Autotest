# Copy this file to tests_base.cfg and edit it.
#
# Define the objects we'll be using
vms = vm1
images = image1
nics = nic1

# Choose the main VM
main_vm = vm1

# Some preprocessor/postprocessor params
start_vm = yes
convert_ppm_files_to_png_on_error = yes
#keep_ppm_files = yes
#keep_ppm_files_on_error = yes
kill_vm = no
kill_vm_gracefully = yes
kill_unresponsive_vms = yes

# Some default VM params
qemu_binary = qemu
qemu_img_binary = qemu-img
smp = 1
mem = 512
image_size = 10G
shell_port = 22
display = vnc

# Default scheduler params
used_cpus = 1
used_mem = 512

# Port redirections
redirs = remote_shell
guest_port_remote_shell = 22

# NIC parameters
nic_mode = user
#nic_mode = tap
nic_script = scripts/qemu-ifup
address_index = 0


# Tests
variants:
    - install:
        type = steps
        fail_if_stuck_for = 300
        stuck_detection_history = 2
        keep_screendump_history = yes
        force_create_image = yes
        kill_vm = yes
        kill_vm_timeout = 60
        kill_vm_timeout_on_error = 0

    - setup:        install
        type = steps
        fail_if_stuck_for = 300
        stuck_detection_history = 2
        kill_vm_on_error = yes
        keep_screendump_history = yes

    - unattended_install:
        type = unattended_install
        kill_vm = yes
        kill_vm_gracefully = yes
        kill_vm_on_error = yes
        force_create_image = yes
        pre_command += " scripts/unattended.py;"
        floppy = "images/floppy.img"
        extra_params += " -boot d"
        nic_mode = user

    - boot:         install setup unattended_install
        type = boot
        restart_vm = yes
        kill_vm_on_error = yes

    - reboot:       install setup unattended_install
        type = boot
        reboot_method = shell
        kill_vm_on_error = yes

    - migrate:      install setup unattended_install
        type = migration
        migration_test_command = help
        migration_bg_command = "cd /tmp; nohup tcpdump -q -t ip host localhost"
        migration_bg_check_command = pgrep tcpdump
        migration_bg_kill_command = pkill tcpdump
        kill_vm_on_error = yes
        iterations = 2
        used_mem = 1024

    - autotest:     install setup unattended_install
        type = autotest
        test_timeout = 1800
        variants:
            - sleeptest:
                test_name = sleeptest
                test_timeout = 30
                test_control_file = sleeptest.control
            - dbench:
                test_name = dbench
                test_control_file = dbench.control
            - bonnie:
                test_name = bonnie
                test_control_file = bonnie.control
            - ebizzy:
                test_name = ebizzy
                test_control_file = ebizzy.control
            - stress:
                test_name = stress
                test_control_file = stress.control
            - disktest:
                test_name = disktest
                test_control_file = disktest.control
            - ctcs2:
                test_name = cerberus
                # If you think this is too lengthy, please change the cerberus
                # control file and set this timeout appropriately.
                test_timeout = 3900
                test_control_file = cerberus.control
            - npb:
                test_name = npb
                test_control_file = npb.control
            - hackbench:
                test_name = hackbench
                test_control_file = hackbench.control
            - cpu_hotplug:
                test_name = cpu_hotplug
                test_control_file = cpu_hotplug.control

    - linux_s3:     install setup unattended_install
        type = linux_s3

    - timedrift:    install setup unattended_install
        extra_params += " -rtc-td-hack"
        variants:
            - with_load:
                type = timedrift
                # Pin the VM and host load to CPU #0
                cpu_mask = 0x1
                # Set the load and rest durations
                load_duration = 20
                rest_duration = 20
                # Fail if the drift after load is higher than 50%
                drift_threshold = 50
                # Fail if the drift after the rest period is higher than 10%
                drift_threshold_after_rest = 10
                # For now, make sure this test is executed alone
                used_cpus = 100
            - with_migration:
                type = timedrift_with_migration
                migration_iterations = 3
                drift_threshold = 10
                drift_threshold_single = 3
            - with_reboot:
                type = timedrift_with_reboot
                reboot_iterations = 1
                drift_threshold = 10
                drift_threshold_single = 3

    - stress_boot:  install setup unattended_install
        type = stress_boot
        max_vms = 5    
        alive_test_cmd = uname -a
        clone_address_index_base = 10
        kill_vm = yes
        kill_vm_vm1 = no
        kill_vm_gracefully = no
        extra_params += " -snapshot"
        used_cpus = 5
        used_mem = 2560

    - autoit:       install setup unattended_install
        type = autoit
        autoit_binary = D:\AutoIt3.exe
        autoit_script_timeout = 600
        autoit_script_params =
        variants:
            - notepad:
                autoit_script = autoit/notepad1.au3
            - stub:
                download = yes
                download_cmd = "git clone"
                rsc_server = "git://the.resource.server/autoit"
                dst_rsc_dir = "C:\"
                autoit_entry = "C:\autoit\stub\stub.au3"

    - guest_s4:     install setup unattended_install
        type = guest_s4
        check_s4_support_cmd = grep -q disk /sys/power/state
        test_s4_cmd = "cd /tmp; nohup tcpdump -q -t ip host localhost"
        check_s4_cmd = pgrep tcpdump
        set_s4_cmd = echo disk > /sys/power/state
        kill_test_s4_cmd = pkill tcpdump
        services_up_timeout = 30

    - nic_hotplug:  install setup unattended_install
        type = pci_hotplug
        pci_type = nic
        reference_cmd = lspci
        find_pci_cmd = 'lspci | tail -n1'
        pci_test_cmd = 'nslookup www.redhat.com'
        wait_secs_for_hook_up = 3
        variants:
            - nic_8139:
                pci_model = rtl8139
                match_string = "8139"
            - nic_virtio:
                pci_model = virtio
                match_string = "Virtio network device"
            - nic_e1000:
                pci_model = e1000
                match_string = "Gigabit Ethernet Controller"

    - block_hotplug: install setup unattended_install
        type = pci_hotplug
        pci_type = block
        reference_cmd = lspci
        find_pci_cmd = 'lspci | tail -n1'
        images += " stg"
        boot_drive_stg = no
        image_name_stg = storage
        image_size_stg = 1G
        remove_image_stg = yes
        force_create_image_stg = yes
        pci_test_cmd = "yes | mke2fs `fdisk -l 2>&1 | awk '/\/dev\/[sv]d[a-z] doesn/ {print $2}'`"
        wait_secs_for_hook_up = 3
        kill_vm_on_error = yes
        variants:
            - block_virtio:
                pci_model = virtio
                match_string = "Virtio block device"
            - block_scsi:
                pci_model = scsi
                match_string = "SCSI"
        variants:
            - fmt_qcow2:
                image_format_stg = qcow2
            - fmt_raw:
                image_format_stg = raw

    - vlan_tag:  install setup unattended_install
        type = vlan_tag
        # subnet should not be used by host
        subnet = 192.168.123
        vlans = "10 20"
        nic_mode = tap
        vms += " vm2"
        extra_params_vm1 += " -snapshot"
        extra_params_vm2 += " -snapshot"
        kill_vm_gracefully_vm2 = no
        address_index_vm2 = 1

    - physical_resources_check: install setup unattended_install
        type = physical_resources_check
        catch_uuid_cmd = dmidecode | awk -F: '/UUID/ {print $2}'

    - ksm_overcommit:
        # Don't preprocess any vms as we need to change its params
        vms = ''
        image_snapshot = yes
        kill_vm_gracefully = no
        type = ksm_overcommit
        # Make host use swap (a value of 'no' will turn off host swap)
        ksm_swap = yes
        no hugepages
        # Overcommit of host memmory
        ksm_overcommit_ratio = 3
        # Max paralel runs machine
        ksm_parallel_ratio = 4
        # Host memory reserve
        ksm_host_reserve = 512
        ksm_guest_reserve = 1024
        variants:
            - ksm_serial:
                ksm_mode = "serial"
            - ksm_parallel:
                ksm_mode = "parallel"

    # system_powerdown, system_reset and shutdown *must* be the last ones
    # defined (in this order), since the effect of such tests can leave
    # the VM on a bad state.
    - system_powerdown: install setup unattended_install
        type = shutdown
        shutdown_method = system_powerdown
        sleep_before_powerdown = 20
        kill_vm = yes
        kill_vm_gracefully = no

    - system_reset: install setup unattended_install
        type = boot
        reboot_method = system_reset
        sleep_before_reset = 20
        kill_vm_on_error = yes

    - shutdown:     install setup unattended_install
        type = shutdown
        shutdown_method = shell
        kill_vm = yes
        kill_vm_gracefully = no
    # Do not define test variants below shutdown


# NICs
variants:
    - @rtl8139:
        nic_model = rtl8139
    - e1000:
        nic_model = e1000
    - virtio:
        nic_model = virtio


# Guests
variants:
    # Linux section
    - @Linux:
        no timedrift autoit
        shutdown_command = shutdown -h now
        reboot_command = shutdown -r now
        status_test_command = echo $?
        username = root
        password = 123456
        shell_client = ssh
        shell_port = 22
        file_transfer_client = scp
        file_transfer_port = 22
        mem_chk_cmd = dmidecode -t 17 | awk -F: '/Size/ {print $2}'
        cpu_chk_cmd = grep -c processor /proc/cpuinfo

        variants:
            - Fedora:
                no setup
                shell_prompt = "^\[.*\][\#\$]\s*$"
                unattended_install:
                    tftp = "images/tftpboot"
                    extra_params += " -bootp /pxelinux.0 -boot n"
                    kernel_args = "ks=floppy nicdelay=60"

                variants:
                    - 8.32:
                        no setup
                        image_name = fc8-32
                        cdrom = linux/Fedora-8-i386-DVD.iso
                        md5sum = dd6c79fddfff36d409d02242e7b10189
                        md5sum_1m = dabae451bb69fbbad0e505b25144b1f9
                        install:
                            steps = Fedora-8-i386.steps
                        unattended_install:
                            unattended_file = unattended/Fedora-8.ks

                    - 8.64:
                        no setup
                        image_name = fc8-64
                        cdrom = linux/Fedora-8-x86_64-DVD.iso
                        md5sum = 2cb231a86709dec413425fd2f8bf5295
                        md5sum_1m = 145f6414e19492649a56c89f0a45e719
                        install:
                            steps = Fedora-8-64.steps
                        unattended_install:
                            unattended_file = unattended/Fedora-8.ks

                    - 9.32:
                        image_name = fc9-32
                        cdrom = linux/Fedora-9-i386-DVD.iso
                        md5sum = 72601f685ea8c808c303353d8bf4d307
                        md5sum_1m = f24fa25689e5863f1b99984c6feb787f
                        install:
                            steps = Fedora-9-i386.steps
                        unattended_install:
                            unattended_file = unattended/Fedora-9.ks

                    - 9.64:
                        image_name = fc9-64
                        cdrom = linux/Fedora-9-x86_64-DVD.iso
                        md5sum = 05b2ebeed273ec54d6f9ed3d61ea4c96
                        md5sum_1m = 9822ab5097e37e8fe306ef2192727db4
                        install:
                            steps = Fedora-9-64.steps
                        unattended_install:
                            unattended_file = unattended/Fedora-9.ks

                    - 10.32:
                        image_name = fc10-32
                        cdrom = linux/Fedora-10-i386-DVD.iso
                        md5sum = 27e581edb392728c4a07d00d3fc5ced0
                        md5sum_1m = bd67c68bdf595e4ba7131ec702159181
                        unattended_install:
                            unattended_file = unattended/Fedora-10.ks

                    - 10.64:
                        image_name = fc10-64
                        cdrom = linux/Fedora-10-x86_64-DVD.iso
                        sha1sum = f1e5ae7db6a1ba227de7294c4112385922388648
                        md5sum_1m = 732857cbf40c80c34683e874601d982c
                        unattended_install:
                            unattended_file = unattended/Fedora-10.ks

                    - 11.32:
                        image_name = fc11-32
                        cdrom = linux/Fedora-11-i386-DVD.iso
                        md5sum = e3b1e2d1ba42aa4705fa5f41771b3927
                        md5sum_1m = dc8ddf90648c247339c721395aa49714
                        install:
                            steps = Fedora-11-32.steps
                        unattended_install:
                            unattended_file = unattended/Fedora-11.ks

                    - 11.64:
                        image_name = fc11-64
                        cdrom = linux/Fedora-11-x86_64-DVD.iso
                        md5sum = 9d419844adeb93120215fe7505c9bce8
                        md5sum_1m = 405ee05e2387a2e4328b008d5bcbdd1e
                        unattended_install:
                            unattended_file = unattended/Fedora-11.ks

                    - 12.32:
                        image_name = fc12-32
                        cdrom = linux/Fedora-12-i386-DVD.iso
                        md5sum = 2c4c1c0d09f2fbcfd8ee6a0c5542eeb2
                        md5sum_1m = eee935d7f0cf2ef03f6ddce3a2a50050
                        unattended_install:
                            unattended_file = unattended/Fedora-12.ks

                    - 12.64:
                        image_name = fc12-64
                        cdrom = linux/Fedora-12-x86_64-DVD.iso
                        md5sum = 6dd31e292cc2eb1140544e9b1ba61c56
                        md5sum_1m = 514efbd7698b55ff6768c8605438bfc5
                        unattended_install:
                            unattended_file = unattended/Fedora-12.ks

            - DSL-4.2.5:
                no setup dbench bonnie linux_s3
                image_name = dsl-4.2.5
                install:
                    steps = DSL-4.2.5.steps
                    cdrom = linux/dsl-4.2.5.iso
                    md5sum = 61694888aede3e01229865b8e6acd4a1
                    md5sum_1m = 527f2481bd25310f2e3a6e5345ff3d12

            - Mandriva-One-2007:
                only install
                image_name = mandriva-one-2007
                steps = Mandriva-One-2007-32.steps
                cdrom = linux/mandriva-one-2007-i386.iso
                md5sum = 7e9e183dc11b9d39f480238e4e12bb05
                md5sum_1m = dc7865a75db665efc86d59bca7c1fe07

            - openSUSE-11.0.32:
                no setup dbench bonnie
                image_name = openSUSE-11.0-32
                install:
                    steps = openSUSE-11.0-32.steps
                    cdrom = linux/openSUSE-11.0-DVD-i386.iso
                    md5sum = ed6a5b3feb668866df812b1c2aed9d7f
                    md5sum_1m = c720b30557af758e69de450409516369

            - openSUSE-11.1.32:
                no setup dbench bonnie
                image_name = openSUSE-11.1-32
                install:
                    steps = openSUSE-11.1-32-and-64.steps
                    cdrom = linux/openSUSE-11.1-DVD-i586.iso
                    md5sum = 8f51b278c0415be28c5699e465444bd3
                    md5sum_1m = b70217417468389083429f81ba7ce2bd

            - openSUSE-11.1.64:
                no setup dbench bonnie
                image_name = openSUSE-11.1-64
                install:
                    steps = openSUSE-11.1-32-and-64.steps
                    cdrom = linux/openSUSE-11.1-DVD-x86_64.iso
                    md5sum = 2afee1b8a87175e6dee2b8dbbd1ad8e8
                    md5sum_1m = 768ca32503ef92c28f2d144f2a87e4d0

            - @Ubuntu:
                shell_prompt = "^root@.*[\#\$]\s*$"

                variants:
                    - Ubuntu-6.10-32:
                        only install
                        image_name = ubuntu-6.10-32
                        steps = Ubuntu-6.10-32.steps
                        cdrom = linux/ubuntu-6.10-desktop-i386.iso
                        md5sum = 17fb825641571ce5888a718329efd016
                        md5sum_1m = 7531d0a84e7451d17c5d976f1c3f8509

                    - Ubuntu-8.04-32:
                        skip = yes
                        image_name = ubuntu-8.04-32
                        install:
                            steps = Ubuntu-8.04-32.steps
                            cdrom = linux/ubuntu-8.04.1-desktop-i386.iso
                        setup:
                            steps = Ubuntu-8.04-32-setupssh.steps

                    - Ubuntu-8.10-server-32:
                        image_name = ubuntu-8.10-server-32
                        install:
                            steps = Ubuntu-8.10-server-32.steps
                            cdrom = linux/ubuntu-8.10-server-i386.iso
                            md5sum = a2ec9975a91e1228c8292ed9799dc302
                            md5sum_1m = ea493eb8ef7722ead693492fd9f8a13f
                        setup:
                            steps = Ubuntu-8.10-server-32-gcc.steps

            - RHEL:
                no setup
                shell_prompt = "^\[.*\][\#\$]\s*$"
                nic_hotplug:
                    modprobe_module = acpiphp
                block_hotplug:
                    modprobe_module = acpiphp
                unattended_install:
                    tftp = "images/tftpboot"
                    extra_params += " -bootp /pxelinux.0 -boot n"
                    kernel_args = "ks=floppy nicdelay=60"

                variants:
                    - 3.9.i386:
                        no setup autotest linux_s3
                        image_name = rhel3-32
                        mem_chk_cmd = dmidecode | awk -F: '/Maximum Capacity/ {print $2}'
                        cdrom = linux/RHEL-3.9-i386-DVD.iso
                        md5sum = ddd11a1cb104119039b0fa05df6d52b8
                        md5sum_1m = 5f10c9417c7b8372b3456c1b5f3f9ed0
                        install:
                            steps=RHEL-3.9-i386.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-3-series.ks

                    - 3.9.x86_64:
                        no setup autotest linux_s3
                        image_name = rhel3-64
                        mem_chk_cmd = dmidecode | awk -F: '/Maximum Capacity/ {print $2}'
                        cdrom = linux/RHEL-3.9-x86_64-DVD.iso
                        md5sum = bf4635e4a4bd3b43838e72bc8c329d55
                        md5sum_1m = 18ecd37b639109f1b2af05cfb57dfeaf
                        install:
                            steps=RHEL-3.9-x86_64.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-3-series.ks

                    - 4.7.i386:
                        no setup autotest
                        image_name = rhel4-32
                        cdrom=linux/RHEL-4.7-i386-DVD.iso
                        md5sum=ee5092653732a88ddbaf8eef2484c500
                        md5sum_1m=127081cbed825d7232331a2083975528
                        install:
                            steps=RHEL-4.7-i386.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-4-series.ks

                    - 4.7.x86_64:
                        no setup autotest
                        image_name = rhel4-64
                        cdrom=linux/RHEL-4.7-x86_64-DVD.iso
                        md5sum=ea9dae16dd86f7d94092d0e672333292
                        md5sum_1m=58fa63eaee68e269f4cb1d2edf479792
                        install:
                            steps=RHEL-4.7-x86_64.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-4-series.ks

                    - 4.8.i386:
                        no setup autotest
                        image_name = rhel4-32
                        cdrom = linux/RHEL-4.8-i386-DVD.iso
                        md5sum = b024f0af5079539d3ef51f71fed0b194
                        md5sum_1m = 969c197402b9058f28a278c1f807d15b
                        unattended_install:
                            unattended_file = unattended/RHEL-4-series.ks

                    - 4.8.x86_64:
                        no setup autotest
                        image_name = rhel4-64
                        cdrom = linux/RHEL-4.8-x86_64-DVD.iso
                        md5sum = 696bc877b0200cc942626673fcc3fc09
                        md5sum_1m = b11ac0ef7fd345ad712966972db63886
                        unattended_install:
                            unattended_file = unattended/RHEL-4-series.ks

                    - 5.3.i386:
                        no setup
                        image_name = rhel5-32
                        cdrom=linux/RHEL-5.3-i386-DVD.iso
                        md5sum=371c62851611fd32ead440df6f24a296
                        md5sum_1m=242318dd44152210f6ff6cdda1bfbf51
                        install:
                            steps=RHEL-5.3-i386.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-5-series.ks

                    - 5.3.x86_64:
                        no setup
                        image_name = rhel5-64
                        cdrom=linux/RHEL-5.3-x86_64-DVD.iso
                        md5sum=c5ed6b284410f4d8212cafc78fd7a8c5
                        md5sum_1m=b999f437583098ea5bbd56fb1de1d011
                        install:
                            steps=RHEL-5.3-x86_64.steps
                        unattended_install:
                            unattended_file = unattended/RHEL-5-series.ks

                    - 5.4.i386:
                        no setup
                        image_name = rhel5-32
                        cdrom = linux/RHEL-5.4-i386-DVD.iso
                        md5sum = 7a12ec6599527e4f3d1790b51eadbfed
                        md5sum_1m = 0dbeb8f58d213752d8c029e8601abfbb
                        unattended_install:
                            unattended_file = unattended/RHEL-5-series.ks

                    - 5.4.x86_64:
                        no setup
                        image_name = rhel5-64
                        cdrom = linux/RHEL-5.4-x86_64-DVD.iso
                        md5sum = 04fe3c10202402d7b389528d2bad0210
                        md5sum_1m = 3e74112003e88a966754849dbb8f5c3f
                        unattended_install:
                            unattended_file = unattended/RHEL-5-series.ks

    # Windows section
    - @Windows:
        no autotest linux_s3 vlan_tag
        shutdown_command = shutdown /s /t 0
        reboot_command = shutdown /r /t 0
        status_test_command = echo %errorlevel%
        shell_prompt = "^\w:\\.*>\s*$"
        username = Administrator
        password = 123456
        shell_linesep = "\r\n"
        shell_client = nc
        shell_port = 22
        # File transfers are currently unsupported
        # file_transfer_client = scp
        # file_transfer_port = 22

        # This ISO will be used for all tests except install:
        cdrom = windows/winutils.iso

        cpu_chk_cmd = echo %NUMBER_OF_PROCESSORS%
        mem_chk_cmd = wmic memphysical

        unattended_install:
            timeout = 7200
            finish_program = deps/finish.exe
            cdrom_extra = windows/winutils.iso
        migrate:
            migration_test_command = ver && vol
            migration_bg_command = start ping -t localhost
            migration_bg_check_command = tasklist | find /I "ping.exe"
            migration_bg_kill_command = taskkill /IM ping.exe /F
        stress_boot:
            alive_test_cmd = systeminfo
        timedrift:
            time_command = "echo TIME: %date% %time%"
            time_filter_re = "(?<=TIME: \w\w\w ).{19}(?=\.\d\d)"
            time_format = "%m/%d/%Y %H:%M:%S"
            # For this to work, the cdrom at d: should contain vlc (d:\vlc\vlc.exe) and a video (d:\ED_1024.avi)
            guest_load_command = 'cmd /c "d:\vlc\vlc -f --loop --no-qt-privacy-ask --no-qt-system-tray d:\ED_1024.avi"'
            # Alternative guest load:
            #guest_load_command = "(dir /s && dir /s && dir /s && dir /s) > nul"
            guest_load_stop_command = "taskkill /F /IM vlc.exe"
            guest_load_instances = 2
            host_load_command = "bzip2 -c --best /dev/urandom > /dev/null"
            # Alternative host load:
            #host_load_command = "dd if=/dev/urandom of=/dev/null"
            host_load_instances = 8
        guest_s4:
            check_s4_support_cmd = powercfg /hibernate on
            test_s4_cmd = start ping -t localhost
            check_s4_cmd = tasklist | find /I "ping.exe"
            set_s4_cmd = rundll32.exe PowrProf.dll, SetSuspendState
            kill_test_s4_cmd = taskkill /IM ping.exe /F
            services_up_timeout = 30
        nic_hotplug:
            reference_cmd = ipconfig /all
            find_pci_cmd = ipconfig /all | find "Description"
            wait_secs_for_hook_up = 10
            nic_e1000:
                match_string = "Intel(R) PRO/1000 MT Network Connection"
            nic_virtio:
                match_string = "VirtIO Ethernet"
        block_hotplug:
            wait_secs_for_hook_up = 10
            reference_cmd = wmic diskdrive list brief
            find_pci_cmd = wmic diskdrive list brief
            pci_test_cmd = echo select disk 1 > dt && echo online >> dt && echo detail disk >> dt && echo exit >> dt && diskpart /s dt
        physical_resources_check:
            catch_uuid_cmd = 

        variants:
            - Win2000:
                no reboot
                image_name = win2000-32
                kill_vm_gracefully = no
                install:
                    steps = Win2000-32.steps
                    cdrom = windows/Windows2000_sp4.iso
                    md5sum = dda6039f3a9173f0f6bfae40f5efdfea
                    md5sum_1m = dd28fba196d366d56fe774bd93df5527
                    user = user
                setup:
                    steps = Win2000-32-rss.steps

            - WinXP:
                image_name = winXP
                variants:
                    - 32:
                        image_name += -32
                        install:
                            cdrom = windows/WindowsXP-sp2-vlk.iso
                            md5sum = 743450644b1d9fe97b3cf379e22dceb0
                            md5sum_1m = b473bf75af2d1269fec8958cf0202bfd
                            user = user
                            steps = WinXP-32.steps
                        setup:
                            steps = WinXP-32-rss.steps
                        unattended_install:
                            cdrom = windows/WindowsXP-sp2-vlk.iso
                            md5sum = 743450644b1d9fe97b3cf379e22dceb0
                            md5sum_1m = b473bf75af2d1269fec8958cf0202bfd
                            unattended_file = unattended/winxp32.sif

                    - 64:
                        image_name += -64
                        install:
                            cdrom = windows/WindowsXP-64.iso
                            md5sum = 8d3f007ec9c2060cec8a50ee7d7dc512
                            md5sum_1m = e812363ff427effc512b7801ee70e513
                            user = user
                            steps = WinXP-64.steps
                        setup:
                            steps = WinXP-64-rss.steps
                        unattended_install:
                            cdrom = windows/WindowsXP-64.iso
                            md5sum = 8d3f007ec9c2060cec8a50ee7d7dc512
                            md5sum_1m = e812363ff427effc512b7801ee70e513
                            unattended_file = unattended/winxp64.sif

            - Win2003:
                image_name = win2003
                image_size = 20G
                shutdown_command = shutdown /s /f /t 0
                reboot_command = shutdown /r /f /t 0

                variants:
                    - 32:
                        image_name += -32
                        install:
                            cdrom = windows/Windows2003_r2_VLK.iso
                            md5sum = 03e921e9b4214773c21a39f5c3f42ef7
                            md5sum_1m = 37c2fdec15ac4ec16aa10fdfdb338aa3
                            user = user
                            steps = Win2003-32.steps
                        setup:
                            steps = Win2003-32-rss.steps
                        unattended_install:
                            cdrom = windows/Windows2003_r2_VLK.iso
                            md5sum = 03e921e9b4214773c21a39f5c3f42ef7
                            md5sum_1m = 37c2fdec15ac4ec16aa10fdfdb338aa3
                            unattended_file = unattended/win2003-32.sif

                    - 64:
                        image_name += -64
                        install:
                            cdrom = windows/Windows2003-x64.iso
                            md5sum = 5703f87c9fd77d28c05ffadd3354dbbd
                            md5sum_1m = 439393c384116aa09e08a0ad047dcea8
                            user = user
                            steps = Win2003-64.steps
                        setup:
                            steps = Win2003-64-rss.steps
                        unattended_install:
                            cdrom = windows/Windows2003-x64.iso
                            md5sum = 5703f87c9fd77d28c05ffadd3354dbbd
                            md5sum_1m = 439393c384116aa09e08a0ad047dcea8
                            unattended_file = unattended/win2003-64.sif

            - WinVista:
                image_name = winvista
                image_size = 20G

                variants:
                    - 32sp1:
                        image_name += sp1-32
                        install:
                            cdrom = windows/WindowsVista-32.iso
                            md5sum = 1008f323d5170c8e614e52ccb85c0491
                            md5sum_1m = c724e9695da483bc0fd59e426eaefc72
                            steps = Win-Vista-32.steps
                        setup:
                            steps = WinVista-32-rss.steps
                        unattended_install:
                            cdrom = windows/WindowsVista-32.iso
                            md5sum = 1008f323d5170c8e614e52ccb85c0491
                            md5sum_1m = c724e9695da483bc0fd59e426eaefc72
                            unattended_file = unattended/winvista-32-autounattend.xml

                    - 64sp1:
                        image_name += sp1-64
                        install:
                            cdrom = windows/WindowsVista-64.iso
                            md5sum = 11e2010d857fffc47813295e6be6d58d
                            md5sum_1m = 0947bcd5390546139e25f25217d6f165
                            steps = Win-Vista-64.steps
                        setup:
                            steps = WinVista-64-rss.steps
                        unattended_install:
                            cdrom = windows/WindowsVista-64.iso
                            md5sum = 11e2010d857fffc47813295e6be6d58d
                            md5sum_1m = 0947bcd5390546139e25f25217d6f165
                            unattended_file = unattended/winvista-64-autounattend.xml

                    - 32sp2:
                        image_name += sp2-32
                        unattended_install:
                            cdrom = windows/en_windows_vista_with_sp2_x86_dvd_342266.iso
                            md5sum = 19ca90a425667812977bab6f4ce24175
                            md5sum_1m = 89c15020e0e6125be19acf7a2e5dc614
                            sha1sum = 25ad9a776503e6a583bec07879dbcc5dfd20cd6e
                            sha1sum_1m = a2afa4cffdc1c362dbf9e62942337f4f875a22cf
                            unattended_file = unattended/winvista-32-autounattend.xml

                    - 64sp2:
                        image_name += sp2-64
                        unattended_install:
                            cdrom = windows/en_windows_vista_sp2_x64_dvd_342267.iso
                            md5sum = a1c024d7abaf34bac3368e88efbc2574
                            md5sum_1m = 3d84911a80f3df71d1026f7adedc2181
                            sha1sum = aaee3c04533899f9f8c4ae0c4250ef5fafbe29a3
                            sha1sum_1m = 1fd21bd3ce2a4de8856c7b8fe6fdf80260f6d1c7
                            unattended_file = unattended/winvista-64-autounattend.xml

            - Win2008:
                image_name = win2008
                image_size = 20G
                shutdown_command = shutdown /s /f /t 0
                reboot_command = shutdown /r /f /t 0

                variants:
                    - 32sp1:
                        image_name += sp1-32
                        install:
                            cdrom = windows/Windows2008-x86.iso
                            #en_windows_server_2008_datacenter_enterprise_standard_x86_dvd_X14-26710.iso
                            md5sum=0bfca49f0164de0a8eba236ced47007d
                            md5sum_1m=07d7f5006393f74dc76e6e2e943e2440
                            sha1sum = 6ca018ff96f1e9b2b310a36546b6fded99a421e6
                            steps = Win2008-32.steps
                        setup:
                            steps = Win2008-32-rss.steps
                        unattended_install:
                            cdrom = windows/Windows2008-x86.iso
                            md5sum=0bfca49f0164de0a8eba236ced47007d
                            md5sum_1m=07d7f5006393f74dc76e6e2e943e2440
                            unattended_file = unattended/win2008-32-autounattend.xml

                    - 64sp1:
                        image_name += sp1-64
                        install:
                            steps = Win2008-64.steps
                            cdrom = windows/Windows2008-x64.iso
                            #en_windows_server_2008_datacenter_enterprise_standard_x64_dvd_X14-26714.iso
                            md5sum=27c58cdb3d620f28c36333a5552f271c
                            md5sum_1m=efdcc11d485a1ef9afa739cb8e0ca766
                            sha1sum = bd000374709f67e9358814db6ec8f0ddaaa16f70
                            passwd = 1q2w3eP
                        setup:
                            steps = Win2008-64-rss.steps
                        unattended_install:
                            cdrom = windows/Windows2008-x64.iso
                            md5sum=27c58cdb3d620f28c36333a5552f271c
                            md5sum_1m=efdcc11d485a1ef9afa739cb8e0ca766
                            unattended_file = unattended/win2008-64-autounattend.xml

                    - 32sp2:
                        image_name += sp2-32
                        unattended_install:
                            cdrom = windows/en_windows_server_2008_datacenter_enterprise_standard_sp2_x86_dvd_342333.iso
                            md5sum = b9201aeb6eef04a3c573d036a8780bdf
                            md5sum_1m = b7a9d42e55ea1e85105a3a6ad4da8e04
                            sha1sum = 49d0d6917c1256fe81048d414fa473bbc76a8724
                            sha1sum_1m = 9662ff7ed715faa00407e4befc484ea52a92a9fb
                            unattended_file = unattended/win2008-32-autounattend.xml

                    - 64sp2:
                        image_name += sp2-64
                        unattended_install:
                            cdrom = windows/en_windows_server_2008_datacenter_enterprise_standard_sp2_x64_dvd_342336.iso
                            md5sum = e94943ef484035b3288d8db69599a6b5
                            md5sum_1m = ee55506823d0efffb5532ddd88a8e47b
                            sha1sum = 34c7d726c57b0f8b19ba3b40d1b4044c15fc2029
                            sha1sum_1m = 8fe08b03e3531906855a60a78020ac9577dff5ba
                            unattended_file = unattended/win2008-64-autounattend.xml

                    - r2:
                        image_name += -r2
                        unattended_install:
                            cdrom = windows/en_windows_server_2008_r2_standard_enterprise_datacenter_and_web_x64_dvd_x15-59754.iso
                            md5sum = 0207ef392c60efdda92071b0559ca0f9
                            md5sum_1m = a5a22ce25008bd7109f6d830d627e3ed
                            sha1sum = ad855ea913aaec3f1d0e1833c1aef7a0de326b0a
                            sha1sum_1m = 9194a3aabae25b36e5f73cad001314b2c8d07d14
                            unattended_file = unattended/win2008-r2-autounattend.xml

            - Win7:
                image_name = win7
                image_size = 20G
                shutdown_command = shutdown /s /f /t 0
                reboot_command = shutdown /r /f /t 0

                variants:
                    - 32:
                        image_name += -32
                        unattended_install:
                            cdrom = windows/en_windows_7_ultimate_x86_dvd_x15-65921.iso
                            md5sum = d0b8b407e8a3d4b75ee9c10147266b89
                            md5sum_1m = 2b0c2c22b1ae95065db08686bf83af93
                            sha1sum = 5395dc4b38f7bdb1e005ff414deedfdb16dbf610
                            sha1sum_1m = 9f9c3780aebeb28a9bf22188eed6bc15475dc9c5
                            unattended_file = unattended/win7-32-autounattend.xml

                    - 64:
                        image_name += -64
                        install:
                            cdrom = windows/en_windows_7_ultimate_x64_dvd_x15-65922.iso
                            md5sum=f43d22e4fb07bf617d573acd8785c028
                            md5sum_1m=b44d8cf99dbed2a5cb02765db8dfd48f
                            passwd = 1q2w3eP
                            steps = Win7-64.steps
                        setup:
                            steps = Win7-64-rss.steps
                        unattended_install:
                            cdrom = windows/en_windows_7_ultimate_x64_dvd_x15-65922.iso
                            md5sum = f43d22e4fb07bf617d573acd8785c028
                            md5sum_1m = b44d8cf99dbed2a5cb02765db8dfd48f
                            sha1sum = 326327cc2ff9f05379f5058c41be6bc5e004baa7
                            sha1sum_1m = 4a3903bd5157de54f0702e5263e0a683c5775515
                            unattended_file = unattended/win7-64-autounattend.xml


    # Unix/BSD section
    - @Unix:
        only install
        kill_vm = yes
        kill_vm_gracefully = no
        kill_vm_timeout = 0

        variants:
            - NetBSD-1.6.2:
                image_name = NetBSD-1.6.2
                image_size = 4G
                steps = NetBSD-1.6.2.steps
                cdrom = bsd/netbsd-1.6.2-i386.iso
                md5sum=72eb680300f77d529bfbc880ba8208f3
                md5sum_1m=f1a9e1e825c90adfb1be35c6177bd9ac

            - OpenBSD-4.1:
                image_name = OpenBSD-4.1
                steps = OpenBSD-4.1-32.steps
                cdrom = unix/openbsd41-i386-07-05-06.iso
                md5sum = 984790db10ebdd6fc7a9cf97abc7c967
                md5sum_1m = 8fc234b4b0ecfe56843a32ac1d26ed55

    # Live CD section
    - @livecd:
        only install
        kill_vm = yes
        kill_vm_gracefully = no
        kill_vm_timeout = 0

        variants:
            - Belenix:
                steps = Belenix-0.7.1.steps
                cdrom = unix/belenix_0.7.1.iso
                md5sum = 29cea6160cf5250de138e2820e53e342
                md5sum_1m = 427bbef1b85d6d051799b825d686ae94

            - Slax:
                steps = Slax-6.0.7.steps
                cdrom = linux/slax-6.0.7.iso
                md5sum = cde0ecba3c8289d786e12c44666ded6e
                md5sum_1m = ddf02bc7444f22d1160a6e5a8fc8723f

            - FreeSBIE-2.0.1:
                steps = FreeSBIE-2.0.1.steps
                cdrom = unix/FreeSBIE-2.0.1-RELEASE.iso
                md5sum = b2f680d27c21bbfaf4fb90dce090a118
                md5sum_1m = 4d81ee7fe0101b0a14225963bfff60c1

            - memtest:
                mem = 128
                steps = memtest86+.steps
                cdrom = misc/memtest86+-2.01.iso
                md5sum = 9fae22f2666369968a76ef59e9a81ced


linux_s3:
    only Linux


variants:
    - @up:
        no autotest.npb
    - smp2:
        smp = 2
        used_cpus = 2
        stress_boot: used_cpus = 10
        timedrift.with_load: used_cpus = 100


variants:
    - @acpi:
    - noacpi:
        only Fedora Ubuntu Windows
        no WinVista Win2008
        no smp2.*Windows
        extra_params += " -no-acpi"
    - userirq:
        only Fedora Ubuntu Windows
        extra_params += " -no-kvm-irqchip -no-kvm-pit"


variants:
    - @ide:
        drive_format=ide
    - scsi:
        drive_format=scsi
    - virtio_blk:
        drive_format=virtio
        image_boot=yes


virtio|virtio_blk|e1000:
    only Fedora.11 Fedora.12 Win2008 WinVista Win7 openSUSE-11 Ubuntu-8.10-server


variants:
    - @qcow2:
        image_format = qcow2
        post_command = " python scripts/check_image.py;"
        remove_image = no
        post_command_timeout = 600
    - vmdk:
        only Fedora Ubuntu Windows
        only smp2
        only rtl8139
        only acpi
        image_format = vmdk
    - raw:
        only Fedora Ubuntu Windows
        only smp2
        only rtl8139
        only acpi
        image_format = raw


variants:
    - @smallpages:
    - hugepages:
        pre_command += " scripts/hugepage.py /mnt/kvm_hugepage;"
        extra_params += " -mem-path /mnt/kvm_hugepage"


variants:
    - @no_pci_assignable:
        pci_assignable = no
    - pf_assignable:
        pci_assignable = pf
        device_names = eth1
    - vf_assignable:
        pci_assignable = vf
        # Driver (kernel module) that supports SR-IOV hardware.
        # As of today (30-11-2009), we have 2 drivers for this type of hardware:
        # Intel® 82576 Gigabit Ethernet Controller - igb
        # Neterion® X3100™ - vxge
        driver = igb
        # Driver option to specify the maximum number of virtual functions
        # (on vxge the option is , for example, is max_config_dev)
        # the default below is for the igb driver
        driver_option = "max_vfs=7"
        # Number of devices that are going to be requested.
        devices_requested = 7


image_name.* ?<= images/
cdrom.* ?<= isos/
steps ?<= steps/
